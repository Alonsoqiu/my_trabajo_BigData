---
title: "La loter√≠a de Navidad"
description: |
 Enumero y analizo unas curiosidades de la loter√≠a de Navidad
author:
  - name: Kaikai Qiu(Kaiqiu@alumni.uv.es)
date: 2022-12-17
categories: [trabajo BigData, la riqueza]
image: "./posts/imagenes/imagen_01.png"
title-block-banner: true 
toc: true
toc-location: left
toc-depth: 3
#css: ./assets/my_css_file.css
---

## **1. La introducci√≥n**


La introducci√≥n:El Sorteo Extraordinario de Navidad, tambi√©n conocido como Loter√≠a de Navidad, es uno de los sorteos de loter√≠a m√°s importantes y populares que se celebra en Espa√±a cada 22 de diciembre.  Se divide principalmente en 5 clases: el gordo, 4 000 000 ‚Ç¨; 2¬∫ premio, 1 250 000 ‚Ç¨; 3¬∫ premio, 500 000 ‚Ç¨; 4¬∫ premio, con dos n√∫meros, 200 000 ‚Ç¨ cada uno; 5¬∫ premio, con 8 n√∫meros, 60 000 ‚Ç¨ cada uno; reintegro, 20 ‚Ç¨ si el √∫ltimo n√∫mero es el mismo que el √∫ltimo n√∫mero de gordo.El n√∫mero espec√≠fico de ganancias para cada billete de loter√≠a depende del n√∫mero de serie.


![ ](https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSmh_jALhgnGKKoP9ZAJ-c7bsZzAefh-ruwdA&usqp=CAU)


---

Primero hay que instalar y cargar unos paquetes necesarios.
```{r}
library(tidyverse)
library(sf)
library(ggplot2)
library(plotly)
library(gganimate)
library(palmerpenguins)
library(colorspace)
library("readxl")
library(viridis)
library(geojsonsf)
library(ggthemes)
library(treemap)
library(openxlsx)
library(treemapify)
```

---

## **2.¬øD√≥nde se ha tocado m√°s el gordo?**

Aqu√≠ est√° la distribuci√≥n de gordo en Espa√±a a lo largo de su historia, tanto en orden alfab√©tico como su valor

::: {.panel-tabset}
### Datos no reordendas

```{r}
#| code-fold: true
la_direccion <- "./datos/provincia y gordo.csv"
provincia_gordo <- rio::import(la_direccion)
prov <- pjpv.curso.R.2022::LAU2_prov_2020_canarias

ggplot(provincia_gordo,aes(province,veces,fill=province))+geom_bar(stat='identity')+coord_flip()+geom_text(aes(label=veces),
            position = position_dodge2(width = 0.5, preserve = 'single'),
            size= 3, hjust = 0 )+
          lims(y=c(0,125))+
          scale_y_continuous(limits = c(0,125), expand = c(0, 0))+
  labs(title = "N√∫mero de veces que ha tocado cada provincia en orden alfabetico",
       subtitle = "(un rollo)")

```

### Datos reordenados

```{r}
#| code-fold: true
#con orden
ggplot(provincia_gordo,aes(x= reorder(province,veces),y= veces,fill=province))+geom_bar(stat='identity')+coord_flip()+geom_text(aes(label=veces), position = position_dodge2(width = 0.5, preserve = 'single'),size= 3, hjust = 0 )+
  lims(y=c(0,125))+
  scale_y_continuous(limits = c(0,125), expand = c(0, 0))+
  labs(title = "N√∫mero de veces que ha tocado el gordo cada provincia en funcion de veces",
       x = "Provincias")+
  theme(title=element_text(family="myFont",size=14,color="black",face="italic"),
      axis.title.x=element_text(size=10,face="bold",color="black",hjust=0.5),
      legend.title=element_text(size=14,color="red",hjust=0.5))
```

:::

### **2.1 Datos reordenados pero con treemap**

Con treepmap, podemos tener una comprensi√≥n m√°s intuitiva del n√∫mero y la comparaci√≥n del n√∫mero de veces que se ha tocado entre las provincias: podemos ver que Madrid es la comunidad / provincia m√°s afortunada:107 veces, seguida por Barcelona. Y lo peor es Melilla, a quien nunca le ha tocado el Gordo en los 200 a√±os de historia de la loter√≠a de Navidad.
```{r}
#| code-fold: true
#Tree map
library(treemap)
library(openxlsx)
install.packages("treemapify")
library(treemapify)
ptree <- ggplot(data = provincia_gordo,aes(fill= province,area= veces, label= paste0(province,"\n",veces)))
ptree <- ptree + geom_treemap()
ptree <- ptree + geom_treemap_text(colour="white", place= "centre")
ptree <- ptree + theme(legend.position = "none")
ptree <- ptree + labs(title = "treemap de gordo:N√∫mero de veces que ha tocado el gordo cada                         provincia",
                      subtitle = "(Melilla: 0)")+ 
  theme(title=element_text(family="myFont",size=14,color="black",face="italic"))
ptree
```


---

## **3.La provincia m√°s afortunada**


Sin embargo, la loter√≠a de navidad no es el "Gordo" solamente, los premios del segundo, tercer, cuarto y quinto premio tambi√©n son muy atractivos, aunque los premios son menores que lo del gordo. Para calcular de manera m√°s justa la "provincia m√°s afortunada", asignamos puntos seg√∫n la proporci√≥n de premio: 200/3 al Gordo, 125/6 a segundo premio, 25/3 a tercer premio, 10/3 a cuarto premio y 1 a quinto premio.

>Solo considero la distribuci√≥n del mismo n√∫mero en todo el pa√≠s por provincias, no considero n√∫meros de series que est√°n disponible en cada provincia ni "Centena (tres primeras cifras) del primero premio,etc", porque ya es mucho trabajo y tengo que copiar los datos desde los per√≠odicos y recopilarlos. ‚Äî‚Äî‚Äî‚Äî‚Äî‚ÄîQiu Kaikai

Podemos que la provincia m√°s afortunada es Cantabria, seguida por Madrid.
```{r}
#| code-fold: true
##3.la provincia m√°s afortunada(de todas las provincias)

todo <- read_excel("./datos/todo.xlsx")
todop <- todo %>% mutate(punto= primero*200/3+ segundo*125/6+ tercero*25/3+ cuarto*10/3+ quinto)
prov <- pjpv.curso.R.2022::LAU2_prov_2020_canarias
df_todo <-  full_join(todop, prov, by = c("ine" = "ine_prov"))

ptodo <- ggplot() + 
  geom_sf(data = df_todo, 
          aes(geometry = geometry,fill = punto), 
          size = 0.09) +
  scale_fill_viridis_c(option = "plasma")+
  labs(title = "Puntos seg√∫n todos los premio de 2021", 
       caption = "datos viene de loteriasyapuestas.es") +
  theme(plot.title=element_text
        (family="Times",size=18,hjust = 0.5,color="black",face="bold"),
        legend.title=element_text(size=12,face="bold",color="black",hjust=0.5))+
  theme(plot.background = element_rect(fill = "white"),
        panel.background = element_rect(fill = "grey"))+
  annotate(geom = "text",x= -4.03,y= 45.2,label="La provincia m√°s afortunada: \n Cantabria",size=4.5)+
  geom_segment(aes(x= -4.03, y= 44.6, xend= -4.03, yend= 43.2), size=1.5, arrow = arrow(length = unit(0.3,"cm")))
  
ptodo
```

---

## **4. El gasto medio por habitante en loteria por CCAA y provincia, 2021**


Comprar boletos de loter√≠a de Navidad parece ser una costumbre navide√±a nacional, cuanto m√°s cerca del 22 de diciembre, m√°s larga es la fila afuera de Loter√≠as y Apuestas del Estado. Pero las personas en diferentes lugares gastan diferentes cantidades de dinero en la loter√≠a de Navidad. Los dos gr√°ficos siguientes muestran el gasto medio de los residentes de diferentes comunidades aut√≥nomas y provincias en la loter√≠a de Navidad.

### **4.1 A nivel Comunidades Aut√≥nomas**

*Puede poner el cursor por el territorio de cada comunidad aut√≥noma para conocer el dato concreto.*
Podemos ver que Castilla y Le√≥n es el l√≠der de todo el pa√≠s, mientras que en Ceuta y Melilla los gastos son menor de 20 euros.
```{r}
#| code-fold: true
##4.El gasto medio por habitante en loteria por CCAA y provincia, 2021
library("readxl")
my_data <- read_excel("./datos/gasto_ccaa.xlsx")
library(tidyverse)
library(sf)
library(viridis)
prov <- pjpv.curso.R.2022::LAU2_prov_2020_canarias
prov <- prov %>% select(ine_prov, ine_prov.n, ine_ccaa, ine_ccaa.n)
df_geo_ccaa <- prov %>% 
  group_by(ine_ccaa, ine_ccaa.n) %>% summarize() %>% ungroup() 
df_ok <-  full_join(df_geo_ccaa, my_data, by = c("ine_ccaa" = "codigo"))
##CCAA color
df_ok = sf::st_cast(df_ok, "MULTIPOLYGON")
p <- ggplot(data = df_ok, 
            aes(geometry = geometry,fill = gasto), 
            size = 0.09) + 
     geom_sf() + scale_fill_viridis(option="magma")+
    labs(title = "Gasto medio por habitante en loter√≠a de navidad, CCAA", 
       caption = "datos viene de loteriasyapuestas.es",
       fill = "gasto medio") +
     theme(plot.title=element_text
        (family="Times",size=18,hjust = 0.5,color="black",face="bold"),
         legend.title=element_text(size=12,face="bold",color="black",hjust=0.5))


ggplotly(p)
```

### **4.2 A nivel provincias**

Entre las 52 regiones de nivel provincia por todo el pa√≠s, Soria ha ganado campeonato con dato incre√≠ble: 224‚Ç¨. Esto implica que cada soriano va a comprar m√°s de 11 d√©cimos por cada a√±o. Sin embargo, en los gr√°ficos anteriores sobre "la provincia m√°s afortuna", no aparece Soria. Podemos concluir que Soria es la provincia m√°s desafortunada de Espa√±aü§£ü§£ü§£ü§£ 
```{r}
#| code-fold: true
library(geojsonsf)
provincia <- pjpv.curso.R.2022::LAU2_prov_2020_canarias
mi_data <- read_excel("./datos/gastop.xlsx")
gasto_provincia_1 <- full_join(mi_data,provincia,by=c("ine"="ine_prov")) 
library(plotly)
library(sf)
pprovincia <- ggplot() + 
  geom_sf(data = gasto_provincia_1, 
          aes(geometry = geometry,fill = gasto_medio), 
          size = 0.09) +
  scale_fill_viridis_c(option = "plasma")+
  labs(title = "Gasto medio por habitante en loter√≠a de navidad por provincia", 
       caption = "datos viene de loteriasyapuestas.es") +
  theme(plot.title=element_text
        (family="Times",size=14,hjust = 0.5,color="black",face="bold"),
        legend.title=element_text(size=12,face="bold",color="black",hjust=0.5))+
  theme(plot.background = element_rect(fill = "grey"),
        panel.background = element_rect(fill = "grey"))+
  annotate(geom = "text",x= -2.46,y= 41.76,label="Soria \n 224‚Ç¨",size=3)+
  annotate(geom = "text",x= -2.93,y= 35.29,label="Melilla \n 14‚Ç¨",size=3)+
  annotate(geom = "text",x= 2.5,y= 37,label="Media de Espa√±a \n 66.6‚Ç¨",size=5,alpha=1)
pprovincia

```

---

## **5.Relaci√≥n entre gasto medio de loter√≠a y renta media**


Entonces, ¬øpor qu√© se gasta tanto dinero en Soria? voy a analizar relaci√≥n entre gasto medio de loter√≠a y renta media.
```{r}
#| code-fold: true
##relaci√≥n entre gasto medio de loter√≠a y renta media
renta <- read_excel("./datos/gastoyrenta.xlsx")
df_renta <- ggplot(renta,aes(gasto_medio,renta_neta_media))+ geom_point(color="Green",size=3) + geom_text(aes(label=provincia),size=3,vjust=-1)+
  geom_smooth(method = "lm",color= "Red",se = FALSE)+
  theme_light()+
  scale_x_continuous(breaks = seq(0, 250, 25),limits = c(0,250))+
  labs(title = 
         "La relaci√≥n entre la renta neta media y gasto medio en la loter√≠a de Navidad", 
       subtitle = "(por provincias)",
       caption = "datos viene de INE y loteriasyapuestas.es",
       x = "gasto medio en la loter√≠a de Navidad",
       y = "renta neta media")+
  theme(plot.title=element_text(family="Times",size=16,hjust = 0.5,color="black",face="bold"),
       plot.subtitle=element_text(size=10,face="bold",color="black",hjust=1),
        axis.title.x=element_text(size=10,face="bold",color="black",hjust=0.5),
        axis.title.y=element_text(size=10,face="bold",color="black",hjust=0.5),
        legend.title=element_text(size=12,face="bold",color="black",hjust=0.5))+
  annotate(geom = "text",x= 175,y= 12000,label="gasto medio=0.0063renta neta-6.87",size=4)

ggplotly(df_renta)

```

Podemos decir por cada aumento 1000 de renta media neta por habitante, va a gastar 6 euros en la loter√≠a de Navidad.

---

## **6.El n√∫mero m√°s afortunado**


Los n√∫meros de Gordo tambi√©n son muy ¬®importantes¬®, en especial el √∫ltimo n√∫mero, **El reintegro**: si el √∫ltimo de nuestro d√©cimo le coincide, recuperaremos nuestro 20 euros. En este gr√°fico, resumimos las veces que cada n√∫mero ha aparecido como el reintegro en la historia.
```{r}
#| code-fold: true
##6.El reintegro
library(ggthemes)
el_link <- "./datos/numeros1812 .csv"
reintegro <- rio::import(el_link)
reintegro <- reintegro %>% tidyr::separate(gordo,sep = "",into=c("primero","segundo","terceo","cuarto","quinto","sexto")) %>%
  mutate(ultimo=ifelse(is.na(sexto),quinto,sexto)) %>%
  mutate(ultimonumero=ifelse(is.na(ultimo),cuarto,ultimo)) %>% select(1:9)
reintegro1 <- reintegro %>% group_by(ultimonumero)%>% summarise(NN=n()) 

ggplot(data = reintegro1,aes(ultimonumero,NN,fill= ultimonumero )) + 
  geom_bar(stat='identity') +
  geom_text(aes(label=NN),
             position = position_dodge2(width = 0.5, preserve = 'single'),
             size= 6, hjust = 0.5 )+
  scale_y_continuous(limits = c(0,35), expand = c(0, 0)) +
  labs(title = "5Ôºåel reintegro m√°s frecuente",
       x = "Los n√∫meros",
       y = "veces")+
  scale_fill_discrete(name = "Los n√∫meros")+
         theme_solarized()+
  theme(plot.title=element_text(family="Times",size=16,hjust = 0.5,color="black",face="bold"),
        axis.title.x=element_text(size=10,face="bold",color="black",hjust=0.5),
        axis.title.y=element_text(size=10,face="bold",color="black",hjust=0.5),
        legend.title=element_text(size=12,face="bold",color="black",hjust=0.5))+
  scale_color_brewer(palette = "Dark2")
```
Podemos ver el n√∫mero 4, 5 y 6 son los afortunados.


---

## **7.Unas administraciones de loter√≠a famosas**


Durante los m√°s de 200 a√±os de historia de la loter√≠a de Navidad, ha habido muchos lugares de loter√≠a famosos que he marcado en el mapa a continuaci√≥n. Lo m√°s famoso, por supuesto es **Do√±a Manolita** de Madrid, un aut√©ntico s√≠mbolo de la capital espa√±ola. Esta administraci√≥n vende alrededor de 70 millones de d√©cimos al a√±o, sobre todo en esta √©poca del a√±o y en relaci√≥n al Sorteo Extraordinario. 

En cuanto a nuestra Comunitat, se destaca **Loter√≠a Manises**. La administraci√≥n de loter√≠a Manises ha conseguido repartir El Gordo durante los a√±os 1971, 1986, 2001, 2013, y 2018, lo que ha convertido al municipio de 30.000 habitantes en la localidad de Espa√±a donde m√°s veces ha ca√≠do el primer premio de la Loter√≠a de Navidad.

```{r}
#| include: FALSE
library(leaflet)
leaflet() %>% addTiles() %>% leafem::addMouseCoordinates()
```

```{r}
#| code-fold: true
m <- leaflet() %>%
  addTiles() %>% 
  setView(lng = -3.70474, lat = 40.41897, zoom = 6) %>% 
  addMarkers(lng = -3.70474, lat = 40.41897, popup = "Do√±a Manolita") %>% 
  addMarkers(lng = -0.45648, lat = 39.49060, popup = "Loter√≠a Manises") %>% 
  addMarkers(lng =  2.16538, lat = 41.38885, popup = "El gato negro") %>% 
  addMarkers(lng = -1.13289, lat = 37.98457, popup = "La envidiosa millonaria de Murcia") %>%
  addMarkers(lng = -2.93637, lat = 43.26162, popup = "Ormaechea de Bilbao") %>% 
  addMarkers(lng = -5.99445, lat = 37.39087, popup = "Sagasta los millones de Sevilla") %>%
  addMarkers(lng = -4.78587, lat = 41.62857, popup = "La rana de oro de Valladolid") %>%
  addPopups(lng = -3.70474, lat = 40.41897, popup = "Do√±a Manolita") %>% 
  addPopups(lng = -0.45648, lat = 39.49060, popup = "Loter√≠a Manises") %>% 
  addPopups(lng =  2.16538, lat = 41.38885, popup = "El gato negro") 
m
```


---

## **8. Conclusi√≥n**


Personalmente, "comprar loter√≠a" es un evento aleatorio, y no podemos encontrar ninguna regla. Esas "provincias de la suerte y tiendas de loter√≠a" son solo por las grandes ventas. Si realmente quiere aumentar sus posibilidades de ganar, todav√≠a tiene que ir a esas grandes ciudades para comprar; si solo quiere recuperar su dinero, comprar n√∫meros que terminen en 4~6 ser√≠a una buena opci√≥n. Pero no invierta demasiado dinero, no vale la pena invertir en un evento de peque√±a probabilidad.
Finalmente, ¬°suerte a todos!

(Os adjunto el v√≠deo que hicieron el sorteo)
```{r, echo = FALSE, out.width = "60%"}
library(vembedr)
embed_url("https://www.youtube.com/watch?v=3pzCtzf3wG8")
```

---

### **Bibliograf√≠a**
-[Loter√≠a de Navidad: n√∫meros premiados, en datos y gr√°ficos](https://www.epdata.es/datos/loteria-navidad-numeros-premiados-datos-graficos/246)

-[20minutos](https://www.20minutos.es/noticia/4908474/0/gordo-sorteo-loteria-navidad-2021/)

-[El pa√≠s](https://elpais.com/loteria-de-navidad/2021-12-22/segundo-premio-de-la-loteria-de-navidad-2021.html)

-[Estos son los quintos premios en la Loter√≠a de Navidad: 89109, 34345, 89053, 69457, 92052, 70316, 26711 y 24198](https://www.lavanguardia.com/loterias/loteria-navidad/20211222/7932050/quinto-premio-loteria-navidad-2021.html)



---



